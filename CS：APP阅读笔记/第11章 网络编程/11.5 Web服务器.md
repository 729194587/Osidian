
Web服务器和客户端之间的交互适用HTTP协议。
一个Web客户端（浏览器）打开一个到服务器的因特网连接，然后请求某些内容，服务器响应请求，关闭连接。浏览器读取响应内容，显示到屏幕上。

Web服务和常规的文件服务的区别在于它用HTML语言来进行编写。

```html
<b> Make me bold! </b>
```
HTML 真正的强大之处在于一个页面可以包含指针（超链接），这些指针可以指向存放在任何因特网主机上的内容。

web服务器以两种方式提供服务：
- 将磁盘文件内容返回给客户端。磁盘文件**静态内容**（static content），而返回文件给客户端的过程称为**服务静态内容**（serving static content）。
- 运行一个可执行文件，并将它的输出返回给客户端。 动态内容和服务动态内容。

在事务过程中，客户端和服务器使用的是 URL 的不同部分。
客户端使用前缀
**http://www.google.com:80**
来决定与哪类服务器联系，服务器在哪里，以及它监听的端口号是多少。服务器使用后缀
**/index.html**
来发现在它文件系统中的文件，并确定请求的是静态内容还是动态内容。

确定一个 URL 指向的是静态内容还是动态内容没有规则，一个方法是确定一组目录，例如`cgi-bin`，所有的可执行性文件都必须存放这些目录中。

### HTTP 事务

HTTP（超文本传输协议）是一种 **基于文本行** 的 **应用层协议**，即浏览器和服务器之间传输的数据是纯文本格式，例如：
```vb
GET / HTTP/1.1
Host: www.example.com
```
**通过一个 TCP 连接向 80 端口（默认 HTTP 端口）发送这些文本行**，服务器就会像对待浏览器那样返回响应。
Telnet 是一个简单的终端程序，它允许你连接到远程主机的某个端口，并手动输入内容，直接发送到 TCP 连接里。
```c
telnet www.example.com 80
```
### 服务动态内容


1. 客户端如何将程序参数传递给服务器
GET 请求的参数在 URI 中传递。一个 “?” 字符分隔了文件名和参数，而每个参数都用一个 “&” 字符分隔开。参数中不允许有空格，而必须用字符串 “％20” 来表示。

2. 服务器如何将参数传递给子进程
在服务器接收请求:
```c
GET /cgi-bin/adder?15000&213 HTTP/1.1
```
调用 fork 来创建一个子进程，并调用execve在子进程的上下文中执行 `/cgi-bin/adder` 程序。

3. 服务器如何将其他信息传递给子进程
CGI （Common Gateway Interface，通用网关接口）定义了大量的其他环境变量，一个 CGI 程序在它运行时可以设置这些环境变量，从而给子进程传递消息。

4. 子进程将它的输出发送到哪里
CGI 程序通过标准输出（`stdout`）打印输出内容。Web 服务器把 CGI 子进程的标准输出重定向到客户端 socket 上，这些输出将作为 HTTP 响应返回给客户端。

### 为什么使用 `dup2` 重定向而不是直接用 socket 写？

- **通用性**：CGI 程序通常不关心自己是在终端还是在 Web 服务器里运行，它只写到标准输出。
- **兼容性**：无需修改 CGI 程序，只要它输出，就能作为 Web 响应。
- **简单**：通过继承文件描述符，子进程无需知道网络细节。

CGI 最大的问题是 —— **每个请求都要 fork + exec 一个新进程，太慢且不适合高并发**。

**FastCGI：启动固定数量的进程，长期存在，重复处理多个请求**

现代 Web 都不是直接生成 HTML，而是使用 Web 框架：
- 性能更高
- 框架提供路由、中间件、模板、会话、ORM
- 不需要 fork 子进程
**服务器模式：**
- 反向代理（Nginx/Apache）将 HTTP 请求转发给后台程序
- 后台程序负责处理动态逻辑

或者使用**反向代理 + 应用服务器（现代最常见架构）**

```swift
Browser → Nginx → Flask/Django/Spring Boot/Node.js
```
